
        function generatePages() {
            const contentDiv = document.getElementById("content");
            contentDiv.innerHTML = ""; // Limpa as p치ginas anteriores

            let marginSize = parseInt(document.getElementById("marginSize").value);
            let text = localStorage.getItem("savedLyrics") || lyricsText;

            let pages = [];
            let currentPage = createPage(marginSize);
            let currentText = document.createElement("div");
            currentText.classList.add("lyrics");
            currentText.setAttribute("contenteditable", "true");
            currentText.innerHTML = text; // Agora renderiza o HTML corretamente
            currentText.addEventListener("input", adjustPages);

            currentPage.appendChild(currentText);
            pages.push(currentPage);
            contentDiv.appendChild(currentPage);

            // Adiciona evento para focar na p치gina espec칤fica ao clicar nela
            currentPage.addEventListener("click", function (event) {
                event.stopPropagation(); // Impede que o clique afete outras p치ginas
                currentText.focus();
                moveCursorToEnd(currentText);
            });

            adjustPages(currentText); // Chama a fun칞칚o para garantir que as p치ginas sejam ajustadas inicialmente
        }

        function createPage(marginSize) {
            let page = document.createElement("div");
            page.classList.add("page");
            page.style.padding = `${marginSize}mm`;
            return page;
        }

        function saveContent() {
            let lyricsHtml = document.querySelector(".lyrics").innerHTML; // Salva o HTML formatado
            localStorage.setItem("savedLyrics", lyricsHtml);
            alert("Conte칰do salvo!");
        }

        function adjustPages(currentText) {
            // Checa se h치 mais de uma p치gina
            let lyricsContainers = document.querySelectorAll(".lyrics");
            let pages = document.querySelectorAll(".page");

            if (lyricsContainers.length > 0) {
                let lyricsContainer = lyricsContainers[lyricsContainers.length - 1];
                let maxHeight = pages[pages.length - 1].clientHeight - 140; // Ajuste para margens

                // Verifica se o conte칰do excede a altura da p치gina
                if (lyricsContainer.scrollHeight > maxHeight) {
                    let marginSize = parseInt(document.getElementById("marginSize").value);
                    let newPage = createPage(marginSize);
                    let newLyrics = document.createElement("div");
                    newLyrics.classList.add("lyrics");
                    newLyrics.setAttribute("contenteditable", "true");

                    // Transfere o texto excedente para a nova p치gina sem cortar palavras
                    let overflowText = splitOverflowText(lyricsContainer, maxHeight);
                    if (overflowText) {
                        newLyrics.innerHTML = overflowText;
                        lyricsContainer.innerHTML = lyricsContainer.innerHTML.replace(overflowText, "").trim();
                    }

                    newPage.appendChild(newLyrics);
                    document.querySelector("#content").appendChild(newPage);

                    // Evento para focar na nova p치gina ao clicar
                    newPage.addEventListener("click", function (event) {
                        event.stopPropagation();
                        newLyrics.focus();
                        moveCursorToEnd(newLyrics);
                    });

                    // Chama adjustPages novamente para garantir que o texto foi ajustado corretamente
                    setTimeout(() => adjustPages(newLyrics), 100); // Delays para garantir a execu칞칚o sem travar
                }
            }
        }

        // Fun칞칚o para dividir corretamente o texto sem cortar palavras
        function splitOverflowText(container, maxHeight) {
            let words = container.innerHTML.split(" ");
            let tempText = "";
            let testElement = document.createElement("div");
            testElement.style.visibility = "hidden";
            testElement.style.position = "absolute";
            testElement.classList.add("lyrics");
            document.body.appendChild(testElement);

            for (let i = 0; i < words.length; i++) {
                testElement.innerHTML = tempText + " " + words[i];
                if (testElement.scrollHeight > maxHeight) {
                    document.body.removeChild(testElement);
                    return words.slice(i).join(" ");
                }
                tempText += " " + words[i];
            }

            document.body.removeChild(testElement);
            return "";
        }

        // Fun칞칚o para mover o cursor para o final do texto
        function moveCursorToEnd(element) {
            let range = document.createRange();
            let selection = window.getSelection();
            range.selectNodeContents(element);
            range.collapse(false); // Posiciona o cursor no final do conte칰do
            selection.addRange(range); // Adiciona o novo range (sele칞칚o) para mover o cursor
        }

        // Fun칞칚o para criar uma nova p치gina manualmente
        function addNewPage() {
            let contentDiv = document.getElementById("content");
            let marginSize = 20; // Padr칚o de margem
            let newPage = createPage(marginSize);

            let newLyrics = document.createElement("div");
            newLyrics.classList.add("lyrics");
            newLyrics.setAttribute("contenteditable", "true");
            newPage.appendChild(newLyrics);
            contentDiv.appendChild(newPage);

            // Evento para focar na p치gina ao clicar
            newPage.addEventListener("click", function () {
                newLyrics.focus();
                moveCursorToEnd(newLyrics);
            });

            // Move o foco automaticamente para a nova p치gina criada
            newLyrics.focus();
        }

        // Evento para o bot칚o de adicionar p치gina
        window.onload = generatePages;

        /*///////////////////////////
        RECENTE ABAIXO
        */

        function adjustPages() {
            let lyricsContainers = document.querySelectorAll(".lyrics");
            let pages = document.querySelectorAll(".page");

            lyricsContainers.forEach((lyricsContainer, index) => {
                let maxHeight = pages[index].clientHeight - 140; // Ajuste para compensar margens
                if (lyricsContainer.scrollHeight > maxHeight) {
                    console.log("Altura excedida na p치gina:", index + 1);

                    let marginSize = parseInt(document.getElementById("marginSize").value);
                    let newPage = createPage(marginSize);
                    let newLyrics = document.createElement("div");
                    newLyrics.classList.add("lyrics");
                    newLyrics.setAttribute("contenteditable", "true");

                    // Transfere o texto excedente para a nova p치gina sem cortar palavras
                    let overflowText = splitOverflowText(lyricsContainer, maxHeight);
                    if (overflowText) {
                        newLyrics.innerHTML = overflowText;
                        lyricsContainer.innerHTML = lyricsContainer.innerHTML.replace(overflowText, "").trim();
                    }

                    newPage.appendChild(newLyrics);
                    document.querySelector("#content").appendChild(newPage);

                    // Evento para focar na p치gina correta ao clicar
                    newPage.addEventListener("click", function (event) {
                        event.stopPropagation();
                        newLyrics.focus();
                        moveCursorToEnd(newLyrics);
                    });

                    // Mant칠m o foco na p치gina onde o usu치rio est치 digitando
                    if (document.activeElement === lyricsContainer) {
                        newLyrics.focus();
                        moveCursorToEnd(newLyrics);
                    }
                }
            });
        }

        /***
         * C칍DIGO MAIS RECENTE ABAIXO
         * EM FUNCIONAMENTO ATUAL 11:59 08/03
         */

          function generatePages() {
            const contentDiv = document.getElementById("content");
            contentDiv.innerHTML = ""; // Limpa as p치ginas anteriores

            let marginSize = parseInt(document.getElementById("marginSize").value);
            let text = localStorage.getItem("savedLyrics") || lyricsText;

            let pages = [];
            let currentPage = createPage(marginSize);
            let currentText = document.createElement("div");
            currentText.classList.add("lyrics");
            currentText.setAttribute("contenteditable", "true");
            currentText.innerHTML = text; // Agora renderiza o HTML corretamente
            addEventListenersToLyrics(currentText); // Aplica eventos ao texto



            currentPage.appendChild(currentText);
            pages.push(currentPage);
            contentDiv.appendChild(currentPage);

            // Adiciona evento para focar na p치gina espec칤fica ao clicar nela
            currentPage.addEventListener("click", function (event) {
                event.stopPropagation(); // Impede que o clique afete outras p치ginas
                currentText.focus();
                moveCursorToEnd(currentText);
            });


        }
        function addEventListenersToLyrics(lyricsElement) {
            lyricsElement.addEventListener("input", adjustPages);
            lyricsElement.addEventListener("keyup", handleBackspace);
        }



        function createPage(marginSize) {
            let page = document.createElement("div");
            page.classList.add("page");
            page.style.padding = `${marginSize}mm`;
            return page;
        }

        function saveContent() {
            let lyricsHtml = document.querySelector(".lyrics").innerHTML; // Salva o HTML formatado
            localStorage.setItem("savedLyrics", lyricsHtml);
            alert("Conte칰do salvo!");
        }

        function adjustPages() {
            // Seleciona todas as p치ginas dispon칤veis no documento.
            let pages = document.querySelectorAll(".page");

            // Seleciona todos os elementos que cont칡m as letras da m칰sica.
            let lyricsContainers = document.querySelectorAll(".lyrics");

            // Seleciona o container principal onde as p치ginas est칚o sendo adicionadas.
            let contentContainer = document.querySelector("#content");

            // Itera sobre cada container de letras (cada bloco de texto dentro das p치ginas).
            lyricsContainers.forEach((lyricsContainer, index) => {
                // Define a altura m치xima permitida para o texto dentro de uma p치gina.
                let maxHeight = pages[index].clientHeight - 140; // Ajusta para compensar margens.

                // Enquanto o conte칰do for maior do que o espa칞o dispon칤vel na p치gina, divide o texto.
                while (lyricsContainer.scrollHeight > maxHeight) {
                    console.log("Texto excedendo a p치gina:", index + 1);
                    console.log("lyricsContainer.scrollHeight: ", lyricsContainer.scrollHeight);
                    console.log("maxHeight: ", maxHeight);

                    // Obt칠m o tamanho da margem configurado pelo usu치rio.
                    let marginSize = parseInt(document.getElementById("marginSize").value);

                    // Cria uma nova p치gina para continuar o texto que n칚o couber na atual.
                    let newPage = createPage(marginSize);

                    // Cria um novo container para o texto excedente.
                    let newLyrics = document.createElement("div");
                    newLyrics.classList.add("lyrics");
                    newLyrics.setAttribute("contenteditable", "true"); // Permite edi칞칚o do texto.

                    // Separa o texto excedente que precisa ser movido para a nova p치gina.
                    let overflowText = splitOverflowText(lyricsContainer, maxHeight);

                    // Se n칚o houver texto para mover, evita um loop infinito e sai da fun칞칚o.
                    if (!overflowText.trim()) return;

                    // Define o novo container com o texto excedente.
                    newLyrics.innerHTML = overflowText;

                    // Remove o texto excedente da p치gina original para manter o fluxo correto.
                    lyricsContainer.innerHTML = lyricsContainer.innerHTML.replace(overflowText, "").trim();

                    // Adiciona o novo container de texto dentro da nova p치gina criada.
                    newPage.appendChild(newLyrics);

                    // Adiciona a nova p치gina ao container principal de conte칰do.
                    contentContainer.appendChild(newPage);

                    // Adiciona os eventos necess치rios ao novo container de texto.
                    addEventListenersToLyrics(newLyrics);

                    // Evento para focar automaticamente na nova p치gina ao clicar nela.
                    newPage.addEventListener("click", function (event) {
                        event.stopPropagation(); // Evita que o clique afete outros elementos.
                        newLyrics.focus(); // Define o foco no novo campo de texto.
                        moveCursorToEnd(newLyrics); // Move o cursor para o final do texto.
                    });

                    // Se o usu치rio estava digitando no container original, move o foco para o novo.
                    if (document.activeElement === lyricsContainer) {
                        newLyrics.focus();
                        moveCursorToEnd(newLyrics);
                    }

                    // Atualiza a lista de p치ginas para incluir a nova p치gina criada.
                    pages = document.querySelectorAll(".page");
                }
            });
        }



        /* ## function adjustPages() {
            let lyricsContainers = document.querySelectorAll(".lyrics");
            let pages = document.querySelectorAll(".page");



            lyricsContainers.forEach((lyricsContainer, index) => {
                let maxHeight = pages[index].clientHeight - 140; // Ajuste para compensar margens
                if (lyricsContainer.scrollHeight > maxHeight) {
                    console.log("Altura excedida na p치gina:", index + 1);

                    let marginSize = parseInt(document.getElementById("marginSize").value);
                    let newPage = createPage(marginSize);
                    let newLyrics = document.createElement("div");
                    newLyrics.classList.add("lyrics");
                    newLyrics.setAttribute("contenteditable", "true");

                    let overflowText = splitOverflowText(lyricsContainer, maxHeight);
                    if (!overflowText.trim()) return; // Se n칚o houver texto para mover, evita loop infinito

                    newLyrics.innerHTML = overflowText;
                    lyricsContainer.innerHTML = lyricsContainer.innerHTML.replace(overflowText, "").trim();

                    newPage.appendChild(newLyrics);
                    document.querySelector("#content").appendChild(newPage);

                    // Evento para focar na p치gina correta ao clicar
                    newPage.addEventListener("click", function (event) {
                        event.stopPropagation();
                        newLyrics.focus();
                        moveCursorToEnd(newLyrics);
                    });

                    // Mant칠m o foco na p치gina onde o usu치rio est치 digitando
                    if (document.activeElement === lyricsContainer) {
                        newLyrics.focus();
                        moveCursorToEnd(newLyrics);
                    }
                }
            });
        } #*/

        /****  RECENTE
         function adjustPages(currentText) {
              let pages = document.querySelectorAll(".page");
              let maxHeight = pages[pages.length - 1].clientHeight - 140;
              let lyricsContainer = pages[pages.length - 1].querySelector(".lyrics");
              //console.log(maxHeight);
  
              if (!lyricsContainer) return; // Garante que h치 conte칰do antes de continuar
  
              // Se o conte칰do ainda estiver cabendo, n칚o faz nada
              if (lyricsContainer.scrollHeight <= maxHeight) return;
  
              // Criar uma nova p치gina apenas se houver texto excedente
              let marginSize = parseInt(document.getElementById("marginSize").value);
              let newPage = createPage(marginSize);
              let newLyrics = document.createElement("div");
              newLyrics.classList.add("lyrics");
              newLyrics.setAttribute("contenteditable", "true");
  
              console.log("scrollHeight: " + lyricsContainer.scrollHeight);
              console.log("maxHeight: " + maxHeight);
  
              let overflowText = splitOverflowText(lyricsContainer, maxHeight);
              if (!overflowText.trim()) return; // Se n칚o houver texto para mover, evita loop infinito
  
              newLyrics.innerHTML = overflowText;
              lyricsContainer.innerHTML = lyricsContainer.innerHTML.replace(overflowText, "").trim();
  
              newPage.appendChild(newLyrics);
              document.querySelector("#content").appendChild(newPage);
  
              addEventListenersToLyrics(newLyrics); // Adiciona eventos corretamente
  
              newPage.addEventListener("click", function (event) {
                  event.stopPropagation();
                  newLyrics.focus();
                  moveCursorToEnd(newLyrics);
              });
  
  
              // 游댠 Apenas chama `adjustPages` novamente se ainda houver texto excedente
              if (newLyrics.scrollHeight >= maxHeight) {
                  setTimeout(() => adjustPages(newLyrics), 100);
  
              }
          }*******/



        // Fun칞칚o para dividir corretamente o texto sem cortar palavras
        function splitOverflowText(container, maxHeight) {
            // Divide o texto do container em um array de palavras, separando pelo espa칞o.
            let words = container.innerHTML.split(" ");

            // Vari치vel tempor치ria para armazenar o texto enquanto testamos o tamanho.
            let tempText = "";

            // Cria um elemento tempor치rio para medir a altura do texto.
            let testElement = document.createElement("div");

            // Esconde o elemento tempor치rio para que ele n칚o seja vis칤vel na p치gina.
            testElement.style.visibility = "hidden";

            // Posiciona o elemento de forma absoluta para que ele n칚o afete o layout.
            testElement.style.position = "absolute";

            // Adiciona a classe "lyrics" ao elemento tempor치rio para manter a mesma formata칞칚o.
            testElement.classList.add("lyrics");

            // Adiciona o elemento tempor치rio ao corpo do documento.
            document.body.appendChild(testElement);

            // Itera sobre cada palavra do texto para verificar at칠 onde cabe na p치gina.
            for (let i = 0; i < words.length; i++) {
                // Define o conte칰do do elemento tempor치rio com o texto acumulado + a pr칩xima palavra.
                testElement.innerHTML = tempText + " " + words[i];

                // Verifica se a altura do elemento ultrapassa o limite m치ximo da p치gina.
                if (testElement.scrollHeight > maxHeight) {
                    // Remove o elemento tempor치rio do documento para evitar lixo no DOM.
                    document.body.removeChild(testElement);

                    // Retorna o texto excedente, ou seja, o que n칚o coube na p치gina.
                    return i > 0 ? words.slice(i).join(" ") : "";
                }

                // Se o texto ainda cabe na p치gina, adiciona a palavra atual ao texto tempor치rio.
                tempText += " " + words[i];
            }

            // Remove o elemento tempor치rio ap칩s a verifica칞칚o, caso todo o texto tenha cabido.
            document.body.removeChild(testElement);

            // Retorna uma string vazia se todo o texto couber na p치gina sem precisar ser cortado.
            return "";
        }

        // Fun칞칚o para mover o cursor para o final do texto
        function moveCursorToEnd(element) {
            let range = document.createRange();
            let selection = window.getSelection();
            range.selectNodeContents(element);
            range.collapse(false); // Posiciona o cursor no final do conte칰do
            selection.addRange(range); // Adiciona o novo range (sele칞칚o) para mover o cursor
        }



        // Fun칞칚o para criar uma nova p치gina manualmente
        function addNewPage() {
            let contentDiv = document.getElementById("content");
            let marginSize = 20; // Padr칚o de margem
            let newPage = createPage(marginSize);

            let newLyrics = document.createElement("div");
            newLyrics.classList.add("lyrics");
            newLyrics.setAttribute("contenteditable", "true");
            newPage.appendChild(newLyrics);
            contentDiv.appendChild(newPage);

            // Evento para focar na p치gina ao clicar
            newPage.addEventListener("click", function () {
                newLyrics.focus();
                moveCursorToEnd(newLyrics);
            });

            // Move o foco automaticamente para a nova p치gina criada
            newLyrics.focus();
        }
        // Evento para o bot칚o de adicionar p치gina

        function handleBackspace(event) {

            if (event.key === "Backspace") {
                let pages = document.querySelectorAll(".page");
                let firstPage = pages[0];
                let allTextContainers = document.querySelectorAll(".lyrics");

                allTextContainers.forEach((textContainer, index) => {
                    if (textContainer.innerHTML == "" && pages[index] && pages.length > 1) {
                        pages[index].remove();
                        adjustPages();
                    }
                });
            }
        }


        window.onload = generatePages;
