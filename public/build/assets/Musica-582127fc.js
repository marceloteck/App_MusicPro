import{_ as me,Q as ve,r as E,m as p,T as he,k as fe,c as r,d as o,t as d,f as m,F as k,l as g,g as b,D as be,v as L,j as P,h as W,B as H,u as T,n as q,o as i}from"./app-0b8657a5.js";const ye={class:"music-header"},_e={class:"music-title"},ke={key:0,class:"text-muted"},ge={key:1,class:"meta"},xe={key:0},Ce={key:1},we={key:2},Ae={class:"music-actions"},Se={class:"tabs"},Me=["onClick"],$e={key:0,class:"panel"},Fe={class:"lyrics-block"},Ee={key:1,class:"panel"},Le={class:"toolbar"},Te={class:"pill"},ze={class:"pill"},Ve={class:"pill"},Be={class:"pill"},De={class:"form-check-label"},Ue={class:"form-check-label"},Ge={key:0,class:"divider"},Ne={key:1,class:"music-line"},Oe={class:"chord"},Ie={class:"lyric"},Re={key:0,class:"correction-box"},je=["disabled"],Pe={key:2,class:"panel"},We={key:0,class:"video-frame"},He=["src"],qe={key:1},Qe=["href"],Ze={key:3,class:"panel"},Je={key:0,class:"history-list"},Ke={class:"history-meta"},Xe={class:"text-muted"},Ye={class:"history-content"},es={key:1,class:"text-muted"},ss={key:4,class:"panel"},ts={__name:"Musica",props:{musica:{type:Object,required:!0},versions:{type:Array,default:()=>[]}},setup(x){const c=x,Q=ve(),Z=[{key:"letras",label:"Letras"},{key:"cifras",label:"Cifras"},{key:"videos",label:"Vídeos"},{key:"historico",label:"Histórico"}],v=E("cifras"),y=E(!1),l=E({fontSize:18,transpose:0,capoEnabled:!1,capoFret:0,chordColor:"#3fb6ff",boldChord:!0,boldLyric:!1}),_=p(()=>{var s,e,t,n,a;return Array.isArray((s=c.musica)==null?void 0:s.lyrics)?c.musica.lyrics.join(`
`):typeof((e=c.musica)==null?void 0:e.lyrics)=="string"?c.musica.lyrics:Array.isArray((t=c.musica)==null?void 0:t.letra)?c.musica.letra.join(`
`):((n=c.musica)==null?void 0:n.texto)??((a=c.musica)==null?void 0:a.chords)??""}),J=p(()=>{var s,e;return((s=c.musica)==null?void 0:s.title)??((e=c.musica)==null?void 0:e.titulo)??"Cifra"}),z=p(()=>{var s,e;return((s=c.musica)==null?void 0:s.artist)??((e=c.musica)==null?void 0:e.artista)??""}),C=p(()=>{var s;return((s=c.musica)==null?void 0:s.composer)??""}),w=p(()=>{var s;return((s=c.musica)==null?void 0:s.singer)??""}),A=p(()=>{var s;return((s=c.musica)==null?void 0:s.description)??""}),V=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],B=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],D=(s,e)=>(s%e+e)%e,K=s=>/[A-G]b/.test(s),U=s=>{const e=V.indexOf(s);return e!==-1?e:B.indexOf(s)},G=(s,e)=>e?B[s]:V[s],X=(s,e,t)=>{const n=/^([A-G])([#b]?)(.*?)(?:\/([A-G])([#b]?)(.*))?$/,a=s.match(n);if(!a)return s;const u=a[1]+(a[2]||""),M=a[3]||"",$=a[4]?a[4]+(a[5]||""):null,I=a[6]||"",R=U(u);if(R===null)return s;const F=G(D(R+e,12),t);if($){const j=U($);if(j===null)return`${F}${M}/${$}${I}`;const pe=G(D(j+e,12),t);return`${F}${M}/${pe}${I}`}return`${F}${M}`},N=s=>/^[A-G](#|b)?([a-zA-Z]{0,5})?\d*(\([^)]+\))?(\/[A-G](#|b)?)?$/.test(s),Y=s=>{const e=s.trim();if(!e||e.includes("[")&&e.includes("]"))return!1;const t=e.split(/\s+/).filter(Boolean);return t.length?t.filter(N).length>=Math.max(1,Math.ceil(t.length*.6)):!1},ee=s=>{const e=[],t=/\S+/g;let n;for(;(n=t.exec(s))!==null;){const a=n[0];N(a)&&e.push({idx:n.index,chord:a})}return e},se=s=>{let e="";const t=[];let n=0;for(;n<s.length;){if(s[n]==="["){const a=s.indexOf("]",n+1);if(a!==-1){const u=s.slice(n+1,a).trim();u&&t.push({idx:e.length,chord:u}),n=a+1;continue}}e+=s[n],n+=1}return{lyric:e,chords:t}},S=(s,e)=>{const t=e.length?Math.max(...e.map(u=>u.idx)):0,n=Math.max(s.length,t+1),a=new Map;return e.forEach(u=>a.set(u.idx,u.chord)),{lyric:s.padEnd(n," "),chordAt:a,len:n}},te=p(()=>{const s=_.value.replace(/\r\n/g,`
`).split(`
`),e=[];for(let t=0;t<s.length;t+=1){const n=s[t];if(Y(n)&&t+1<s.length){const a=ee(n),u=s[t+1];e.push({type:"music",model:S(u,a)}),t+=1;continue}if(n.includes("[")&&n.includes("]")){const{lyric:a,chords:u}=se(n);e.push({type:"music",model:S(a,u)});continue}if(!n.trim()){e.push({type:"divider"});continue}e.push({type:"music",model:S(n,[])})}return e}),oe=p(()=>l.value.capoEnabled?l.value.transpose-l.value.capoFret:l.value.transpose),ne=p(()=>K(_.value)),le=s=>{const e=[];for(let t=0;t<s.len;t+=1){const n=s.chordAt.get(t)||"";e.push({char:s.lyric[t]??" ",chord:n?X(n,oe.value,ne.value):""})}return e},ae=()=>{l.value.fontSize=Math.min(46,l.value.fontSize+2)},re=()=>{l.value.fontSize=Math.max(12,l.value.fontSize-2)},ie=()=>{l.value.transpose=Math.min(24,l.value.transpose+1)},ce=()=>{l.value.transpose=Math.max(-24,l.value.transpose-1)},h=p(()=>{var s,e;return((s=c.musica)==null?void 0:s.video_url)||((e=c.musica)==null?void 0:e.video)||""}),O=p(()=>{if(!h.value)return"";if(h.value.includes("youtube.com")||h.value.includes("youtu.be")){const s=typeof window>"u"?"http://localhost":window.location.origin,e=new URL(h.value,s);return`https://www.youtube.com/embed/${e.searchParams.get("v")||e.pathname.split("/").pop()}`}return""}),ue=p(()=>{var s;return!!((s=Q.props.auth)!=null&&s.user)}),f=he({content:""});fe(_,s=>{f.content||(f.content=s)},{immediate:!0});const de=()=>{var s;(s=c.musica)!=null&&s.id&&f.post(route("songs.corrections.store",c.musica.id),{preserveScroll:!0})};return(s,e)=>(i(),r("div",{class:q(["music-viewer",{"stage-mode":y.value}]),style:H({"--chordColor":l.value.chordColor,"--chordWeight":l.value.boldChord?800:600,"--lyricWeight":l.value.boldLyric?700:400,"--fontSize":`${l.value.fontSize}px`})},[o("header",ye,[o("div",_e,[o("h1",null,d(J.value),1),z.value?(i(),r("p",ke,d(z.value),1)):m("",!0),w.value||C.value||A.value?(i(),r("div",ge,[w.value?(i(),r("span",xe,"Cantor: "+d(w.value),1)):m("",!0),C.value?(i(),r("span",Ce,"Compositor: "+d(C.value),1)):m("",!0),A.value?(i(),r("span",we,d(A.value),1)):m("",!0)])):m("",!0)]),o("div",Ae,[o("button",{class:"btn btn-outline-secondary",onClick:e[0]||(e[0]=t=>y.value=!y.value)},d(y.value?"Modo normal":"Modo palco"),1),o("button",{class:"btn btn-outline-secondary",onClick:re},"A-"),o("button",{class:"btn btn-outline-secondary",onClick:ae},"A+")])]),o("div",Se,[(i(),r(k,null,g(Z,t=>o("button",{key:t.key,class:q(["tab",{active:v.value===t.key}]),onClick:n=>v.value=t.key},d(t.label),11,Me)),64))]),v.value==="letras"?(i(),r("section",$e,[o("pre",Fe,d(_.value),1)])):v.value==="cifras"?(i(),r("section",Ee,[o("div",Le,[o("div",Te,[e[7]||(e[7]=o("span",{class:"label"},"Tom",-1)),o("button",{class:"btn btn-sm",onClick:ce},"-"),o("b",null,d(l.value.transpose),1),o("button",{class:"btn btn-sm",onClick:ie},"+")]),o("div",ze,[e[9]||(e[9]=o("span",{class:"label"},"Capotraste",-1)),b(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.capoEnabled=t),class:"form-select form-select-sm"},e[8]||(e[8]=[o("option",{value:!1},"Não",-1),o("option",{value:!0},"Sim",-1)]),512),[[be,l.value.capoEnabled]]),b(o("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.capoFret=t),type:"number",min:"0",max:"12",class:"form-control form-control-sm"},null,512),[[L,l.value.capoFret,void 0,{number:!0}]])]),o("div",Ve,[e[10]||(e[10]=o("span",{class:"label"},"Cor cifra",-1)),b(o("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.chordColor=t),type:"color",class:"form-control form-control-color"},null,512),[[L,l.value.chordColor]])]),o("div",Be,[o("label",De,[b(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.boldChord=t),type:"checkbox",class:"form-check-input"},null,512),[[P,l.value.boldChord]]),e[11]||(e[11]=W(" Cifra "))]),o("label",Ue,[b(o("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.boldLyric=t),type:"checkbox",class:"form-check-input"},null,512),[[P,l.value.boldLyric]]),e[12]||(e[12]=W(" Letra "))])])]),o("div",{class:"music-sheet",style:H({"--fs":`${l.value.fontSize}px`})},[(i(!0),r(k,null,g(te.value,(t,n)=>(i(),r("div",{key:n,class:"line-wrapper"},[t.type==="divider"?(i(),r("div",Ge)):(i(),r("div",Ne,[(i(!0),r(k,null,g(le(t.model),(a,u)=>(i(),r("span",{key:u,class:"cell"},[o("span",Oe,d(a.chord),1),o("span",Ie,d(a.char),1)]))),128))]))]))),128))],4),ue.value?(i(),r("div",Re,[e[13]||(e[13]=o("h5",null,"Sugerir correção",-1)),b(o("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>T(f).content=t),class:"form-control",rows:"6",placeholder:"Atualize a cifra/letre como deveria ficar"},null,512),[[L,T(f).content]]),o("button",{class:"btn btn-primary mt-3",type:"button",disabled:T(f).processing,onClick:de}," Enviar correção ",8,je)])):m("",!0)])):v.value==="videos"?(i(),r("section",Pe,[O.value?(i(),r("div",We,[o("iframe",{src:O.value,title:"Vídeo",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,8,He)])):(i(),r("div",qe,[e[14]||(e[14]=o("p",{class:"text-muted"},"Nenhum vídeo encontrado para esta música.",-1)),h.value?(i(),r("a",{key:0,href:h.value,target:"_blank",rel:"noreferrer"},"Abrir link",8,Qe)):m("",!0)]))])):v.value==="historico"?(i(),r("section",Ze,[x.versions.length?(i(),r("div",Je,[(i(!0),r(k,null,g(x.versions,t=>(i(),r("div",{key:t.id,class:"history-item"},[o("div",Ke,[o("strong",null,d(t.source),1),o("span",Xe,"· "+d(new Date(t.created_at).toLocaleString("pt-BR")),1)]),o("pre",Ye,d(t.content),1)]))),128))])):(i(),r("p",es,"Nenhuma versão registrada ainda."))])):(i(),r("section",ss,e[15]||(e[15]=[o("p",{class:"text-muted"},"Selecione uma aba para visualizar o conteúdo.",-1)])))],6))}},ns=me(ts,[["__scopeId","data-v-748a583a"]]);export{ns as default};
