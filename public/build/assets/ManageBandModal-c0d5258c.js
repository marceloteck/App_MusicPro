import{_ as Q,r as p,p as W,k as X,m as y,a as Y,c as d,b as ee,e as oe,o as u,d as t,t as w,f,g,v as S,F as $,l as I,D as T,A as ae,N as c,S as i}from"./app-76e40468.js";const te={class:"ManageBandModalClass"},re={key:0,class:"modal-header"},ne={class:"modal-content"},se={key:0,class:"section"},ie={class:"form-group"},le={class:"form-group"},de={class:"form-group"},ue={class:"section"},ce={key:0},me={key:1},fe={class:"members-list"},be={class:"member-info"},pe={class:"member-name"},ve={class:"member-role"},ge={key:0,class:"member-actions"},Be=["onUpdate:modelValue","onChange"],he=["onClick"],xe={key:2,class:"add-member"},Ce={class:"form-group"},Ee={key:1,class:"section"},_e={class:"form-group"},Me=["value"],ye={key:2,class:"section danger-zone"},we={key:3,class:"section danger-zone"},Se={__name:"ManageBandModal",props:{band:{type:Object,required:!0,validator:v=>v&&typeof v=="object"&&v.id}},setup(v,{expose:N}){var U,A,P;const j=p(!1),s=v,h=p(null),G=W(),O=p("90vh"),D=p(null),m=p({name:((U=s.band)==null?void 0:U.name)||"",description:((A=s.band)==null?void 0:A.description)||"",genre:((P=s.band)==null?void 0:P.genre)||""});X(()=>s.band,a=>{a&&(m.value={name:a.name||"",description:a.description||"",genre:a.genre||""})},{immediate:!0});const C=p(""),E=p("viewer"),_=p(""),B=y(()=>{var a;return(a=G.user)==null?void 0:a.id}),b=y(()=>{var e;if(!((e=s.band)!=null&&e.members)||!B.value)return!1;const a=s.band.members.find(o=>o&&o.user_id===B.value);return(a==null?void 0:a.role)==="admin"}),R=y(()=>{var e;if(!((e=s.band)!=null&&e.members)||!B.value)return!1;const a=s.band.members.find(o=>o&&o.user_id===B.value);return(a==null?void 0:a.role)==="editor"}),k=()=>{h.value?h.value.openModal():console.error("Modal não encontrado")};N({ExecuteManageBandModal:k});const M=()=>{h.value&&h.value.closeModal()},q=()=>{var a;if(!((a=s.band)!=null&&a.id)){console.error("ID da banda não encontrado");return}console.log("Dados sendo enviados para atualização:",{bandId:s.band.id,formData:m.value}),c.put(`/bands/${s.band.id}`,{...m.value,_method:"PUT"},{preserveScroll:!0,onSuccess:e=>{var o,n;console.log("Banda atualizada com sucesso:",e),e.band&&(s.band=e.band),(n=(o=e.props)==null?void 0:o.flash)!=null&&n.success&&i.fire({title:e.props.flash.success,icon:"success",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),M(),c.reload()},onError:e=>{var o;console.error("Erro ao atualizar banda:",e),D.value=e.message||"Erro ao atualizar banda",(o=e.flash)!=null&&o.error?i.fire({title:e.flash.error,icon:"error"}):i.fire({title:"Erro ao atualizar banda",text:e.message||"Ocorreu um erro inesperado",icon:"error"})}})},F=async(a,e)=>{try{const o=s.band.members.filter(r=>r.role==="admin").length,n=s.band.members.find(r=>r.id===a);if(n.role==="admin"&&e!=="admin"&&o<=1){i.fire({title:"Ação não permitida",text:"A banda deve ter pelo menos um administrador.",icon:"warning"});return}const l=s.band.members.findIndex(r=>r.id===a);l!==-1&&(s.band.members[l].role=e),await c.put(`/bands/${s.band.id}/members/${a}`,{role:e},{preserveScroll:!0,onSuccess:()=>{console.log("Papel do membro atualizado com sucesso"),i.fire({title:"Papel atualizado",text:"O papel do membro foi atualizado com sucesso.",icon:"success",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),k()},onError:r=>{l!==-1&&(s.band.members[l].role=n.role),console.error("Erro ao atualizar papel do membro:",r),i.fire({title:"Erro",text:(r==null?void 0:r.message)||"Erro ao atualizar papel do membro",icon:"error"})}})}catch(o){console.error("Erro ao atualizar papel do membro:",o),i.fire({title:"Erro",text:(o==null?void 0:o.message)||"Erro inesperado ao atualizar papel do membro",icon:"error"})}},V=async()=>{var a,e,o;if((a=s.band)!=null&&a.id)try{await c.post(`/bands/${s.band.id}/members`,{email:C.value,role:E.value},{preserveScroll:!0,onSuccess:n=>{var l,r,x;(r=(l=n.props)==null?void 0:l.flash)!=null&&r.success&&i.fire({title:n.props.flash.success,icon:"success",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),C.value="",E.value="",(x=n.props)!=null&&x.band&&(s.band=n.props.band)},onError:n=>{var l;(l=n.flash)!=null&&l.error?i.fire({title:n.flash.error,icon:"error"}):i.fire({title:"Erro ao adicionar membro",text:n.message||"Ocorreu um erro inesperado",icon:"error"})}})}catch(n){i.fire({title:"Erro ao adicionar membro",text:((o=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:o.message)||"Erro inesperado ao adicionar membro",icon:"error"})}},L=async a=>{var o;if(!(!((o=s.band)!=null&&o.id)||!(a!=null&&a.id)||!(await i.fire({title:"Tem certeza?",text:"Deseja remover este membro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sim, remover!",cancelButtonText:"Cancelar"})).isConfirmed))try{await c.delete(`/bands/${s.band.id}/members/${a.id}`,{preserveScroll:!0,onSuccess:()=>{i.fire("Removido!","Membro removido com sucesso.","success"),k()},onError:n=>{i.fire({title:(n==null?void 0:n.message)||"Erro ao remover membro",icon:"error"})}})}catch(n){i.fire({title:"Erro ao remover membro: "+((n==null?void 0:n.message)||"Erro desconhecido"),icon:"error"})}},K=async()=>{var e;if(!(!((e=s.band)!=null&&e.id)||!_.value||!(await i.fire({title:"Transferir liderança",text:"Tem certeza que deseja transferir a liderança desta banda?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sim, transferir!",cancelButtonText:"Cancelar"})).isConfirmed))try{await c.put(`/bands/${s.band.id}/transfer`,{user_id:_.value}),i.fire({title:"Transferido!",text:"A liderança da banda foi transferida com sucesso.",icon:"success",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),c.reload()}catch(o){console.error("Erro ao transferir banda:",o),i.fire({title:"Erro",text:(o==null?void 0:o.message)||"Erro ao transferir liderança da banda",icon:"error"})}},H=()=>{var a;if(!((a=s.band)!=null&&a.id)){console.error("ID da banda não encontrado");return}i.fire({title:"Excluir banda",text:"Tem certeza que deseja excluir esta banda? Esta ação não pode ser desfeita.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sim, excluir!",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&(M(),c.delete(`/bands/${s.band.id}`,{},{preserveScroll:!0,onSuccess:()=>{console.log("Banda excluída com sucesso"),i.fire({title:"Excluído!",text:"A banda foi excluída com sucesso.",icon:"success",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),c.visit("/bands")},onError:o=>{console.error("Erro ao excluir banda:",o),D.value=o.message||"Erro ao excluir banda",i.fire({title:"Erro",text:(o==null?void 0:o.message)||"Erro ao excluir banda",icon:"error"})}}))})},J=()=>{var a;if(!((a=s.band)!=null&&a.id)){console.error("ID da banda não encontrado");return}i.fire({title:"Sair da banda",text:"Tem certeza que deseja sair desta banda?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sim, sair!",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&(M(),c.delete(`/bands/${s.band.id}/leave`,{},{preserveScroll:!0,onSuccess:o=>{var n,l;console.log("Usuário saiu da banda com sucesso"),(l=(n=o.props)==null?void 0:n.flash)!=null&&l.success&&i.fire({title:o.props.flash.success,icon:"success",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),c.visit("/bands")},onError:o=>{var n;console.error("Erro ao sair da banda:",o),(n=o.flash)!=null&&n.error?i.fire({title:o.flash.error,icon:"error"}):i.fire({title:"Erro ao sair da banda",text:o.message||"Ocorreu um erro inesperado",icon:"error"})}}))})},Z=y(()=>{var a;return!((a=s.band)!=null&&a.members)||!B.value?[]:s.band.members.filter(e=>e&&e.user_id&&e.user_id!==B.value)});return(a,e)=>{const o=Y("LayoutModalMobile");return u(),d("div",te,[ee(o,{ref_key:"RefManageBandModal",ref:h,height:O.value},{default:oe(()=>{var n,l;return[b.value?(u(),d("div",re,[t("h2",null,"Gerenciar Banda: "+w((n=v.band)==null?void 0:n.name),1)])):f("",!0),t("div",ne,[b.value||R.value?(u(),d("div",se,[e[9]||(e[9]=t("h3",null,"Informações da Banda",-1)),t("div",ie,[e[6]||(e[6]=t("label",{for:"bandName"},"Nome da Banda",-1)),g(t("input",{type:"text",id:"bandName","onUpdate:modelValue":e[0]||(e[0]=r=>m.value.name=r),placeholder:"Digite o novo nome da banda"},null,512),[[S,m.value.name]])]),t("div",le,[e[7]||(e[7]=t("label",{for:"bandDescription"},"Descrição",-1)),g(t("textarea",{id:"bandDescription","onUpdate:modelValue":e[1]||(e[1]=r=>m.value.description=r),rows:"3",placeholder:"Descreva sua banda"},null,512),[[S,m.value.description]])]),t("div",de,[e[8]||(e[8]=t("label",{for:"bandGenre"},"Gênero Musical",-1)),g(t("input",{type:"text",id:"bandGenre","onUpdate:modelValue":e[2]||(e[2]=r=>m.value.genre=r),placeholder:"Ex: Rock, Pop, Jazz..."},null,512),[[S,m.value.genre]])]),t("button",{onClick:q,class:"btn-update"},"Atualizar Informações")])):f("",!0),t("div",ue,[b.value?(u(),d("h3",ce,"Gerenciar Membros")):f("",!0),b.value?f("",!0):(u(),d("h3",me,"Membros da banda")),t("div",fe,[(u(!0),d($,null,I(((l=v.band)==null?void 0:l.members)||[],r=>{var x;return u(),d("div",{key:r.id,class:"member-item"},[t("div",be,[t("span",pe,w((x=r.user)==null?void 0:x.name),1),t("span",ve,w(r.role),1)]),b.value?(u(),d("div",ge,[g(t("select",{"onUpdate:modelValue":z=>r.role=z,onChange:z=>F(r.id,r.role)},e[10]||(e[10]=[t("option",{value:"admin"},"Admin",-1),t("option",{value:"editor"},"Editor",-1),t("option",{value:"viewer"},"Visualizador",-1)]),40,Be),[[T,r.role]]),t("button",{onClick:z=>L(r),class:"btn-remove"},"Remover",8,he)])):f("",!0)])}),128))]),b.value?(u(),d("div",xe,[e[12]||(e[12]=t("h4",null,"Adicionar Novo Membro",-1)),t("div",Ce,[g(t("input",{type:"email","onUpdate:modelValue":e[3]||(e[3]=r=>C.value=r),placeholder:"Digite o email do usuário",onKeyup:ae(V,["enter"])},null,544),[[S,C.value]]),g(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>E.value=r)},e[11]||(e[11]=[t("option",{value:"editor"},"Editor",-1),t("option",{value:"viewer"},"Visualizador",-1)]),512),[[T,E.value]])]),t("button",{onClick:V,class:"btn-add"},"Adicionar Membro")])):f("",!0)]),j.value?(u(),d("div",Ee,[e[14]||(e[14]=t("h3",null,"Transferir Banda",-1)),t("div",_e,[g(t("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>_.value=r)},[e[13]||(e[13]=t("option",{value:"",disabled:""},"Selecione um membro",-1)),(u(!0),d($,null,I(Z.value,r=>(u(),d("option",{key:r.id,value:r.user_id},w(r.user&&r.user.name),9,Me))),128))],512),[[T,_.value]])]),t("button",{onClick:K,class:"btn-transfer"},"Transferir Banda")])):f("",!0),b.value?(u(),d("div",ye,[e[15]||(e[15]=t("h3",null,"Zona de Perigo",-1)),t("button",{onClick:H,class:"btn-delete"},"Excluir Banda")])):f("",!0),b.value?f("",!0):(u(),d("div",we,[e[16]||(e[16]=t("h3",null,"Sair da Banda",-1)),t("button",{onClick:J,class:"btn-leave"},"Sair da Banda")]))]),t("div",{class:"modal-footer"},[t("button",{onClick:M,class:"btn-cancel"},"Fechar")])]}),_:1},8,["height"])])}}},ze=Q(Se,[["__scopeId","data-v-f6be66c0"]]);export{ze as default};
